<% var bookRef = (page && page.book) || (typeof book !== 'undefined' ? book : null) %>
<% var chapterRef = (typeof chapter !== 'undefined' && chapter) || page || {} %>
<% var cover = bookRef && (bookRef.cover || (theme.books && theme.books.default_cover)) %>
<article class="book-chapter" itemscope itemtype="http://schema.org/Chapter">
  <header class="book-chapter__header">
    <% if (bookRef) { %>
      <p class="book-chapter__series">
        <a href="<%- bookRef.book_path %>" data-analytics-action="book_open" data-analytics-location="chapter_header" data-analytics-book="<%= bookRef.book_slug %>" data-analytics-title="<%= bookRef.title %>"><%= bookRef.title %></a>
      </p>
    <% } %>
    <h1 class="book-chapter__title"><%= chapterRef.title || '' %></h1>
    <% if (chapterRef.subtitle) { %>
      <p class="book-chapter__subtitle"><%= chapterRef.subtitle %></p>
    <% } %>
    <% if (cover) { %>
      <div class="book-chapter__cover">
        <img src="<%- url_for(cover) %>" alt="<%- bookRef.title %> cover">
      </div>
    <% } %>
  </header>

  <div class="content book-chapter__content" itemprop="description">
    <%- chapterRef.content || '' %>
  </div>

  <% var prevRef = (page && page.prev_chapter) || (typeof prev_chapter !== 'undefined' ? prev_chapter : null) %>
  <% var nextRef = (page && page.next_chapter) || (typeof next_chapter !== 'undefined' ? next_chapter : null) %>
  <nav class="book-chapter__nav" aria-label="Chapter navigation">
    <% if (prevRef) { %>
      <a class="book-chapter__nav-link" href="<%- prevRef.path %>" data-analytics-action="chapter_prev" data-analytics-location="chapter_nav" data-analytics-book="<%= (bookRef && bookRef.book_slug) ? bookRef.book_slug : '' %>" data-analytics-chapter="<%= prevRef.slug %>" data-analytics-title="<%= prevRef.title %>">← <%= prevRef.title %></a>
    <% } else { %>
      <span class="book-chapter__nav-spacer"></span>
    <% } %>
    <% if (nextRef) { %>
      <a class="book-chapter__nav-link" href="<%- nextRef.path %>" data-analytics-action="chapter_next" data-analytics-location="chapter_nav" data-analytics-book="<%= (bookRef && bookRef.book_slug) ? bookRef.book_slug : '' %>" data-analytics-chapter="<%= nextRef.slug %>" data-analytics-title="<%= nextRef.title %>"><%= nextRef.title %> →</a>
    <% } else { %>
      <span class="book-chapter__nav-spacer"></span>
    <% } %>
  </nav>
</article>
